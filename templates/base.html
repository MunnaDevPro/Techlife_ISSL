{% load static %}

<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- 
      ================================================================================
      SEO & DYNAMIC METADATA
      - These blocks can be overridden in child templates to provide page-specific SEO.
      - Sensible defaults are provided for general pages.
      ================================================================================
    -->

  <!-- Primary Meta Tags -->
  <title>
    {% block title %}
    TechLife || Know The Current Situation
    {% endblock title %}
  </title>
  {% comment %} {% tailwind_css %} {% endcomment %}
  <meta name="description"
    content="{% block meta_description %}Discover a wide range of high-quality products at unbeatable prices. Your one-stop shop for electronics, fashion, and more.{% endblock meta_description %}" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="{{ request.build_absolute_uri }}" />
  <meta property="og:title"
    content="{% block og_title %}{% block title_for_socials %}{{ self.title }}{% endblock %}{% endblock %}" />
  <meta property="og:description"
    content="{% block og_description %}{% block description_for_socials %}{{ self.meta_description }}{% endblock %}{% endblock %}" />
  <meta property="og:image"
    content="{% block og_image %}{% static 'images/default_og_image.png' %}{% endblock og_image %}" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="{{ request.build_absolute_uri }}" />
  <meta property="twitter:title"
    content="{% block twitter_title %}{% block title_for_socials_twitter %}{{ self.og_title }}{% endblock %}{% endblock %}" />
  <meta property="twitter:description"
    content="{% block twitter_description %}{% block description_for_socials_twitter %}{{ self.og_description }}{% endblock %}{% endblock %}" />
  <meta property="twitter:image"
    content="{% block twitter_image %}{% block og_image_twitter %}{{ self.og_image }}{% endblock %}{% endblock %}" />

  <!-- HTMX CSRF -->
  {% csrf_token %}
  <meta name="csrf-token" content="{{ csrf_token }}" />

  <!-- 
      ================================================================================
      STYLESHEETS & LIBRARIES
      ================================================================================
    -->

    {% comment %} emoji picker {% endcomment %}
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@^1/index.js"></script>



  <!-- Tailwind CSS -->
  <link rel="stylesheet" href="{% static 'css/output.css' %}" />

      <!-- Latest Font Awesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-e..." crossorigin="anonymous" referrerpolicy="no-referrer" />

    

  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- tailwind cdn -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Custom Stylesheet -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- HTMX & Alpine.js -->
  {% comment %} <script src="https://unpkg.com/htmx.org@1.9.12"
    xintegrity="sha384-qbtR4rS9adLkqseSremUcbR/vgFA2A6XPKYoHCi8S4EbMLjI/RJjVqEX+qtYLaqd"
    crossorigin="anonymous"></script> {% endcomment %}
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>


    {% comment %} AOS animation {% endcomment %}
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>


  <!-- DaisyUI Play CDN -->

  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />

  <!-- Poppins Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />


  {% block extra_head %} {% endblock extra_head %}



</head>

<body class="font-inter leading-normal tracking-normal bg-white">
  {% include 'include/navbar.html' %}


{% comment %} 
  <div class="flex bg-white" x-data="{ sidebarOpen: false }" 
    class="flex bg-white"> {% endcomment %}
    {% comment %} <!-- Sidebar -->
    <aside class="h-screen absolute md:sticky z-10 top-16">
      {% include 'include/sidebar.html' %}
    </aside> {% endcomment %}

    <!-- Main Content -->
    <main id="container" class="container mt-24 mx-auto flex-grow min-h-[calc(100vh-128px)] py-6 bg-white"> 
  
      {% block content %}
      <!-- Page content here -->
      {% if action == 'post_create' %}
        {% include 'components/blogs/partial_create_blog_content.html' %}
      {% elif action == 'home_page' %}
        {% include 'components/home/home_page.html' %}
      {% elif action == 'all_blogs' %}
        {% include 'components/blogs/partial_all_blog_page.html' %}
      {% elif action == 'contact_page' %}
        {% include 'partial_contact_us_page.html' %}
      {% elif action == 'category_post' %}
        {% include 'components/category/category_post_partial.html' %}
      {% elif action == 'popular_blogs' %}
        {% include 'components/popular/popular_post_partial.html' %}
      {% elif action == 'all_article' %}
        {% include 'components/category/all_article_partial.html' %}
      {% elif action == 'popular_category_post' %}
        {% include 'components/popular/popular_category_post_partial.html' %}
      {% elif action == 'blog_details' %}
        {% include 'components/blog_details/partial_blog_details_page.html' %}
      {% elif action == 'right_side_update_in_blog_details' %}
        {% include 'components/blog_details/blog_right_side_partial.html' %}

      {% endif %}
      

      {% endblock content %}


       <footer class="p-4 text-center shadow-md bg-white">
    {% include 'include/footer.html' %}
    <p>&copy; {% now "Y" %} TechLife | All Rights Reserved</p>
  </footer>

    
    </main>


    
 
  <!-- =========== LUCIDE ICONS SCRIPT (এই দুটি লাইন যোগ করুন) =========== -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    lucide.createIcons();
  </script>

  <!-- DaisyUI Play CDN -->
 <!-- <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script> -->

  <!-- tailwind -->
 <!-- <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>  -->

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>



    <!-- Reply Toggle Script -->
    <script>
        document.querySelectorAll('.reply-btn').forEach((btn) => {
            btn.addEventListener('click', () => {
                const form = btn.closest('div').parentNode.querySelector('.reply-form');
                form.classList.toggle('hidden');
            });
        });
    </script> 


  <!-- HTMX Configuration & Loading States -->
  <script>
    // =================================================================================
    // নতুন কোড: HTMX Swap-এর পর জাভাস্ক্রিপ্ট পুনরায় চালু করার জন্য ফাংশন
    // =================================================================================
    
    function initializeDynamicContent() {
        let speech = null;
        // নতুন কন্টেন্টে এলিমেন্টগুলি আবার খুঁজতে হবে
        const titleElement = document.getElementById('blog-title');
        const descriptionElement = document.getElementById('blog-description');
        const mainAudioBtn = document.getElementById('main-audio-btn');
        const stopBtn = document.getElementById('stop-btn');
        const iconDisplay = document.getElementById('icon-display');
        const synth = window.speechSynthesis;
        
        // Safety check: অডিও বাটন না থাকলে ফাংশন থেকে বের হয়ে যাও
        if (!mainAudioBtn) {
            // যদি বাটন না থাকে এবং স্পিচ চলছে, তবে তা বন্ধ করো
            if(synth.speaking || synth.paused) synth.cancel();
            return; 
        }
        
        // আগে যদি কোনো স্পিচ চলছিল, তা বন্ধ করা দরকার
        if (synth.speaking || synth.paused) {
             synth.cancel();
        }

        // Button State এবং Icon Update Function 
        function updateUI(isSpeaking, isPaused) {
            if (!iconDisplay || !mainAudioBtn || !stopBtn) return;
            
            if (isSpeaking) {
                if (isPaused) {
                    iconDisplay.textContent = '▶';
                    mainAudioBtn.title = 'Resume';
                } else {
                    iconDisplay.textContent = '⏸';
                    mainAudioBtn.title = 'Pause';
                }
                stopBtn.disabled = false;
            } else {
                iconDisplay.textContent = '▶';
                mainAudioBtn.title = 'Listen';
                stopBtn.disabled = true;
            }
        }

        // mainAudioBtn-এ নতুন ইভেন্ট লিসেনার যোগ করা
        // **onclick ব্যবহার করা হলো যেন পুরনো লিসেনারগুলি মুছে গিয়ে নতুনটি যুক্ত হয়**
        mainAudioBtn.onclick = () => { 
            // A. যদি Pause করা থাকে, তাহলে Resume করো
            if (synth.paused) {
                synth.resume();
                updateUI(true, false);
                return;
            }

            // B. যদি কথা বলছে, তাহলে Pause করো
            if (synth.speaking) {
                synth.pause();
                updateUI(true, true);
                return;
            }

            // C. টাইটেল এবং ডেসক্রিপশন একসাথে আনা
            const titleText = titleElement ? titleElement.textContent : '';
            const descriptionText = descriptionElement ? descriptionElement.textContent : '';
            const textToSpeak = titleText + '. ' + descriptionText;

            if (!textToSpeak.trim()) {
                console.warn('No text content found to speak.');
                return;
            }

            // D. বলা শুরু করো
            speech = new SpeechSynthesisUtterance(textToSpeak);
            speech.lang = 'bn-BD';

            synth.speak(speech);
            updateUI(true, false);

            // E. বলা শেষ হলে UI রিসেট করো
            speech.onend = () => {
                updateUI(false, false);
            };

            // Error হলে
            speech.onerror = (event) => {
                console.error('Speech synthesis error:', event);
                updateUI(false, false);
            };
        };

        // stopBtn-এ নতুন ইভেন্ট লিসেনার যোগ করা
        stopBtn.onclick = () => {
            if (synth.speaking || synth.paused) {
                synth.cancel();
                updateUI(false, false);
            }
        };

        // Initial state set করা
        updateUI(false, false);
        
        
        // ২. কমেন্ট রিপ্লাই টগল স্ক্রিপ্টকে পুনরায় সচল করা 
        // (এটিও HTMX swap-এ নষ্ট হয়, তাই এখানে যোগ করা হলো)
        // --------------------------------------------------------------------
        document.querySelectorAll('.reply-btn').forEach((btn) => {
            btn.onclick = function() {
                const form = this.closest('div').parentNode.querySelector('.reply-form');
                form.classList.toggle('hidden');
            };
        });
    }
    
    // A. প্রথমবার পেজ লোড হওয়ার পর ডাইনামিক কন্টেন্ট ইনিশিয়ালাইজ করা
    document.addEventListener('DOMContentLoaded', initializeDynamicContent);
    
    // B. HTMX Swap সম্পন্ন হওয়ার পর প্রতিবার ডাইনামিক কন্টেন্ট ইনিশিয়ালাইজ করা
    document.body.addEventListener('htmx:afterSwap', function (evt) {
        // শুধুমাত্র যখন #container (যেখানে ব্লগ ডিটেইলস আছে) কন্টেন্ট বদলাবে, তখনই initializeDynamicContent() কল করুন।
        if (evt.detail.target && evt.detail.target.id === 'container') {
            initializeDynamicContent();
            
            // অন্যান্য লাইব্রেরি (যেমন AOS এবং Lucide Icons) নতুন কন্টেন্টের জন্য রিফ্রেশ করা
            if (typeof lucide !== 'undefined') {
                 lucide.createIcons();
            }
            if (typeof AOS !== 'undefined') {
                AOS.refresh(); 
            }
        }
    });

    // HTMX Loading indicator
    document.body.addEventListener('htmx:beforeRequest', function(evt) {
      // Add loading class to content area
      const content = document.getElementById('content');
      if (content) {
        content.style.opacity = '0.6';
        content.style.transition = 'opacity 0.2s ease';
      }
    });

    document.body.addEventListener('htmx:afterRequest', function(evt) {
      // Remove loading state
      const content = document.getElementById('content');
      if (content) {
        content.style.opacity = '1';
      }
    });

    // Handle errors gracefully
    document.body.addEventListener('htmx:responseError', function(evt) {
      console.error('HTMX Error:', evt.detail);
      const content = document.getElementById('content');
      if (content) {
        content.innerHTML = `
          <div class="flex flex-col items-center justify-center min-h-[400px] text-center">
            <h2 class="text-xl font-bold text-red-600 mb-4">Something went wrong</h2>
            <p class="text-gray-600 mb-6">Unable to load the content. Please try again.</p>
            <button onclick="window.location.reload()" 
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
              Refresh Page
            </button>
          </div>
        `;
        content.style.opacity = '1';
      }
    });

    // SEO: Update page title for HTMX requests
    document.body.addEventListener('htmx:afterSettle', function(evt) {
      // Extract title from response if available
      const titleElement = evt.detail.target.querySelector('title, [data-title]');
      if (titleElement) {
        document.title = titleElement.textContent || titleElement.getAttribute('data-title');
      }
    });
</script>

  <!-- Script js -->
  <script src="{% static 'js/script.js' %}"></script>



  <script>
  AOS.init();
</script>
</body>

</html>