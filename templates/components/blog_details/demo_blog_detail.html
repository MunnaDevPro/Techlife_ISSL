{% extends 'base.html' %} {% load static %} {% block content %}

<!-- play, pause button animation -->
<style>
    @keyframes float {
        0% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-3px);
        }

        100% {
            transform: translateY(0);
        }
    }

    .animate-float {
        animation: float 1.8s ease-in-out infinite;
    }
</style>


<header class="max-w-7xl mx-auto pr-16 pl-16 mt-4">
    <i class="fa-solid fa-house"></i>
    <span class="text-sm text-gray-600 pl-2">Bangladesh</span>
    <span class="text-sm text-gray-600 mx-1">/</span>
    <a class="text-sm text-gray-600 hover:text-blue-600 cursor-pointer">{{ blog_detail.category.name }}</a>
</header>

<div class="max-w-7xl mx-auto pr-16 pl-16">
    <div class="flex flex-col md:flex-row md:space-x-8">
        <main class="w-full md:w-2/3 blog-content-area">
            <div class="details">
                <!-- Title -->
                <h1 id="blog-title"
                    class="font-inter pt-2 text-2xl sm:text-3xl font-serif-custom font-extrabold text-gray-900 leading-tight">
                    {{ blog_detail.title }}</h1>


                <!-- Social icons area -->
                <div class="flex justify-between items-center font-inter mt-3 border-t border-gray-200 pt-2">
                    <div class="flex items-center space-x-3 text-sm text-gray-600">
                        <span>
                            <i class="fa-solid fa-user pr-2"></i>
                            {{ blog_detail.author.first_name }}
                            {{ blog_detail.author.last_name }}
                            <!-- {% if blog_detail.author.last_name %}
                                by {{ blog_detail.author.last_name }}
                            {% else %}
                                by {{ blog_detail.author.first_name }}
                            {% endif %} -->

                        </span>
                        <span>
                            <i class="fa-solid fa-eye mr-1 pt-[5px]"></i>
                            {{ blog_detail.views }}
                        </span>
                    </div>



                    <!-- Social Icons -->
                    <div class="flex items-center gap-1.5">
                        <div
                            class="flex w-8 h-8 border rounded-full border-[#1877F2] justify-center items-center hover:bg-[#1877F2] hover:text-white">
                            <a href="#" class="text-[#1877F2] hover:text-white"><i
                                    class="fa-brands fa-facebook-f"></i></a>
                        </div>
                        <div
                            class="flex w-8 h-8 border rounded-full border-[#1DA1F2] justify-center items-center hover:bg-[#1DA1F2] hover:text-white">
                            <a href="#" class="text-[#1DA1F2] hover:text-white"><i
                                    class="fa-brands fa-x-twitter"></i></a>
                        </div>
                        <div
                            class="flex w-8 h-8 border rounded-full border-[#0A66C2] justify-center items-center hover:bg-[#0A66C2] hover:text-white">
                            <a href="#" class="text-[#0A66C2] hover:text-white"><i
                                    class="fa-brands fa-linkedin-in"></i></a>
                        </div>
                        <div
                            class="flex w-8 h-8 border rounded-full border-[#25D366] justify-center items-center hover:bg-[#25D366] hover:text-white">
                            <a href="#" class="text-[#25D366] hover:text-white"><i
                                    class="fa-brands fa-whatsapp"></i></a>
                        </div>
                        <div
                            class="flex w-8 h-8 border rounded-full border-gray-400 justify-center items-center hover:bg-gray-500 hover:text-white">
                            <a href="#" class="text-gray-500 hover:text-white"><i class="fa-solid fa-print"></i></a>
                        </div>
                    </div>
                </div>

                <!-- Blog Image -->
                <div class="relative mt-3">
                    <img class="w-full h-auto object-cover rounded-md" src="{{ blog_detail.featured_image_url }}"
                        alt="AI chip" />
                </div>

                <!-- Author + Share + Save -->
                <div class="mt-2 flex items-center justify-between border">

                    <!-- Left side (Techlife Report) -->
                    <div>
                        <span class="text-blue-600 font-extrabold">
                            TL
                            <span class="text-gray-900 ml-1 font-bold">Techlife Report</span>
                        </span>
                    </div>

                    <!-- Audio Control -->
                    <div class="flex items-center px-3 py-1 cursor-pointer">
                        <div
                            class="audio-controls flex items-center gap-2 group rounded-sm border border-[1px] px-3 border-gray-400 hover:border-blue-500 transition-all duration-500">
                            <button id="main-audio-btn" class="flex items-center gap-1" title="Listen">
                                <span
                                    class="font-inter text-gray-500 text-[12px] group-hover:text-blue-500 transition-all duration-300">Listen</span>
                                <span id="icon-display"
                                    class="text-gray-700 text-[16px] group-hover:text-blue-500 animate-float">â–¶</span>
                            </button>
                        </div>

                    </div>

                </div>

                <div class="flex items-center justify-between text-sm text-gray-600 mt-2">
                    <!-- publis date -->
                    <div>
                        <span class="mr-4">Publish : {{ blog_detail.created_at|date:"d, M Y" }}</span>
                        |
                        <span>Update : {{ blog_detail.updated_at|date:"d, M Y" }}</span>
                    </div>

                    <!-- Right side (Share + Save) -->
                    <div class="flex items-center space-x-6 text-gray-600 font-semibold text-[13px] pr-2">
                        <span class="flex items-center space-x-1 cursor-pointer hover:text-gray-800">
                            <span>Share</span>
                            <svg width="14" height="20" viewBox="0 0 12 14" xmlns="http://www.w3.org/2000/svg"
                                fill="currentColor">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M9.51768 8.96851C8.95518 8.96851 8.44393 9.19851 8.07227 9.57018L4.19727 7.36685C4.24893 7.18768 4.2856 7.00185 4.2856 6.80685C4.2856 6.61102 4.24977 6.42518 4.19893 6.2456L8.06143 4.04935C8.43393 4.42602 8.94977 4.66102 9.51768 4.66102C10.661 4.66102 11.5852 3.73643 11.5852 2.60893C11.5852 1.46518 10.661 0.541016 9.51768 0.541016C8.38977 0.541016 7.4656 1.46518 7.4656 2.60893C7.4656 2.78727 7.49602 2.95768 7.53935 3.12352L3.70727 5.37643C3.33143 4.98477 2.80477 4.73935 2.2181 4.73935C1.09018 4.73935 0.166016 5.6631 0.166016 6.80685C0.166016 7.93476 1.09018 8.85851 2.2181 8.85851C2.8006 8.85851 3.32435 8.61726 3.69977 8.23268L7.54602 10.4943C7.49893 10.6681 7.4656 10.8473 7.4656 11.036C7.4656 12.1639 8.38977 13.0881 9.51768 13.0881C10.661 13.0881 11.5852 12.1639 11.5852 11.036C11.5852 9.89268 10.661 8.96851 9.51768 8.96851">
                                </path>
                            </svg>
                        </span>

                        <span class="flex items-center space-x-1 cursor-pointer hover:text-gray-800">
                            <span>Save</span>
                            <svg width="14" height="20" viewBox="0 0 12 14" xmlns="http://www.w3.org/2000/svg"
                                fill="currentColor">
                                <path
                                    d="M5.99996 9.43351L9.46496 11.0741L9.46496 2.0125L2.53496 2.0125L2.53496 11.0741L5.99996 9.43351ZM0.959961 13.5625L0.959961 0.4375L11.04 0.4375L11.04 13.5625L5.99996 11.1761L0.959961 13.5625Z" />
                            </svg>
                        </span>
                    </div>
                </div>

                <!-- Blog Description -->
                <div id="blog-description" class="article-body mt-6 space-y-5 text-gray-800 font-serif-custom">
                    <p>{{ blog_detail.description|linebreaksbr }}</p>
                </div>

                {% comment %} add section {% endcomment %}
                <div class="flex justify-center items-center bg-gray-200 w-full mx-auto h-[100px] mt-6">
                    <p class="text-gray-500">Google adds (size not define)</p>
                </div>

                <!-- Comment Section -->
                <section id="comments" class="mt-12 border-t border-gray-200 pt-8">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800">Comments ({{ comments.count }})</h2>

                        <!-- Sort dropdown -->
                        <div class="relative">
                            <select id="sort-comments"
                                class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-1 focus:ring-blue-500 focus:outline-none cursor-pointer">
                                <option value="newest" selected><span class="cursor-pointer">Newest</span></option>
                                <option value="oldest"><span class="cursor-pointer">Oldest</span></option>
                                <option value="oldest"><span class="cursor-pointer">Recently</span></option>
                            </select>
                        </div>
                    </div>

                    <!-- Comment Form -->
                    <div class="flex gap-3 mb-8">
                        <!-- User Icon -->
                        <div class="flex-shrink-0">
                            <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User Avatar"
                                class="w-10 h-10 rounded-full border" />
                        </div>

                        <!-- Form -->
                        <form method="" class="flex-1 bg-gray-50 border border-gray-300 rounded-xl p-4 shadow-sm">
                            {% csrf_token %} {% comment %}
                            <div class="flex gap-3 mb-3">
                                <input type="text" name="name" placeholder="Your name"
                                    class="w-1/2 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:outline-none" />
                                <input type="email" name="email" placeholder="Your email"
                                    class="w-1/2 border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:outline-none" />
                            </div>
                            {% endcomment %}
                            <textarea id="messageInput" name="content" rows="2" placeholder="Write your comment..."
                                class="w-full rounded-lg px-3 py-2 focus:ring-1 focus:ring-blue-400 focus:outline-none resize-y"></textarea>

                            <div class="flex justify-between items-center mt-3">
                                <div class="relative flex items-center gap-3 text-gray-500 text-sm">
                                    <!-- Emoji Button -->
                                    <button type="button" id="emojiBtn" title="Add emoji" class="hover:text-blue-600">
                                        <i class="fa-regular fa-face-smile text-xl"></i>
                                    </button>

                                    <!-- File Button -->
                                    <button type="button" id="fileBtn" title="Attach file" class="hover:text-blue-600">
                                        <i class="fa-solid fa-paperclip text-xl"></i>
                                    </button>

                                    <!-- Hidden File Input -->
                                    <input type="file" id="hiddenFileInput" class="hidden" />

                                    <!-- Emoji Picker Container -->
                                    <div id="emojiPicker"
                                        class="absolute bottom-14 left-10 hidden bg-white border rounded-xl p-2 shadow-md z-50">
                                    </div>
                                </div>

                                <button type="submit"
                                    class="bg-blue-500 text-white px-5 py-2 rounded-lg hover:bg-blue-600 transition-all duration-200 font-inter">Comment</button>
                            </div>
                        </form>
                    </div>

                    <!-- Comment List -->
                    <div id="comment-list" class="space-y-5">
                        {% for comment in comments %}
                        <div
                            class="flex gap-3 bg-white border border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-all">
                            <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="User"
                                class="w-10 h-10 rounded-full" />
                            <div class="flex-1">
                                <div class="flex justify-between items-center mb-1">
                                    <h3 class="font-semibold text-gray-800">{{ comment.name }}</h3>
                                    <span class="text-xs text-gray-500">{{ comment.created_at|date:"d M Y, h:i A"
                                        }}</span>
                                </div>
                                <p class="text-gray-700 text-sm">{{ comment.content }}</p>
                            </div>
                        </div>
                        {% empty %}
                        <p class="text-gray-500 italic">No comments yet!</p>
                        {% endfor %}
                    </div>
                </section>
            </div>
        </main>

        <div class="w-[1px] h-auto bg-gray-200">
        </div>

        <aside class="w-full md:w-1/3 mt-8 md:mt-0 space-y-6">
            <div class="bg-gray-200 p-6 flex items-center justify-center h-32">
                <div class="text-center">
                    <img src="https://via.placeholder.com/80x40/FFFFFF/2d3748?text=BSRM" alt="TECHLIFE"
                        class="mx-auto h-10" />
                    <p class="text-sm font-bold text-gray-700 mt-1">ADD</p>
                </div>
            </div>


            <div class="mt-5">
                <div>
                    <h2 class="text-[22px] font-bold text-gray-900 mb-1 font-inter">Related News</h2>
                </div>
                <div class="flex flex-col mb-4">
                    <div class="absolute w-[85px] h-[2px] bg-blue-600"></div>
                    <div class="w-full h-[2px] bg-gray-300"></div>
                </div>



                {% for news in related_news %}
                <a href="{% url 'demo_blog_details_view' news.slug %}"
                    class="flex items-start mb-4 border-b pb-3 relative group">
                    <div
                        class="w-[120px] h-[73px] min-w-[120px] flex-shrink-0 overflow-hidden rounded-md transform transition-transform duration-300 ease-out group-hover:-translate-y-1 group-hover:scale-100">
                        <img class="w-full h-full object-cover block" src="{{ news.featured_image_url }}"
                            alt="{{ news.title }}">
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-gray-800 hover:text-blue-600 cursor-pointer line-clamp-2">{{ news.title
                            }}</p>
                        <span class="text-[11px] text-gray-800">{{ news.created_at|date:"d M Y, h:i A" }}</span>
                    </div>
                </a>
                {% endfor %}


            </div>
        </aside>

    </div>
</div>

<!-- audio control -->
<script>
    let speech = null;
    // à¦¨à¦¤à§à¦¨: à¦Ÿà¦¾à¦‡à¦Ÿà§‡à¦² à¦à¦²à¦¿à¦®à§‡à¦¨à§à¦Ÿà¦Ÿà¦¿ à¦¸à¦¿à¦²à§‡à¦•à§à¦Ÿ à¦•à¦°à¦¾
    const titleElement = document.getElementById('blog-title');
    const descriptionElement = document.getElementById('blog-description');
    const mainAudioBtn = document.getElementById('main-audio-btn');
    const stopBtn = document.getElementById('stop-btn');
    const iconDisplay = document.getElementById('icon-display');
    const synth = window.speechSynthesis;

    // Button State à¦à¦¬à¦‚ Icon Update Function (à¦†à¦—à§‡à¦° à¦®à¦¤à§‹à¦‡ à¦¥à¦¾à¦•à¦¬à§‡)
    function updateUI(isSpeaking, isPaused) {
        if (isSpeaking) {
            if (isPaused) {
                iconDisplay.textContent = 'â–¶';
                mainAudioBtn.title = 'Resume';
            } else {
                iconDisplay.textContent = 'â¸';
                mainAudioBtn.title = 'Pause';
            }
            stopBtn.disabled = false;
        } else {
            iconDisplay.textContent = 'â–¶';
            mainAudioBtn.title = 'Listen';
            stopBtn.disabled = true;
        }
    }

    // Main Button Click Event
    mainAudioBtn.addEventListener('click', () => {
        // A. à¦¯à¦¦à¦¿ Pause à¦•à¦°à¦¾ à¦¥à¦¾à¦•à§‡, à¦¤à¦¾à¦¹à¦²à§‡ Resume à¦•à¦°à§‹
        if (synth.paused) {
            synth.resume();
            updateUI(true, false);
            return;
        }

        // B. à¦¯à¦¦à¦¿ à¦•à¦¥à¦¾ à¦¬à¦²à¦›à§‡, à¦¤à¦¾à¦¹à¦²à§‡ Pause à¦•à¦°à§‹
        if (synth.speaking) {
            synth.pause();
            updateUI(true, true);
            return;
        }

        // C. à¦¨à¦¤à§à¦¨: à¦Ÿà¦¾à¦‡à¦Ÿà§‡à¦² à¦à¦¬à¦‚ à¦¡à§‡à¦¸à¦•à§à¦°à¦¿à¦ªà¦¶à¦¨ à¦à¦•à¦¸à¦¾à¦¥à§‡ à¦†à¦¨à¦¾
        const titleText = titleElement ? titleElement.textContent : '';
        const descriptionText = descriptionElement ? descriptionElement.textContent : '';

        // à¦Ÿà¦¾à¦‡à¦Ÿà§‡à¦², à¦¤à¦¾à¦°à¦ªà¦° à¦à¦•à¦Ÿà¦¿ à¦¬à¦¿à¦°à¦¾à¦®à¦šà¦¿à¦¹à§à¦¨ (à¦¯à§‡à¦®à¦¨ à¦ªà§‚à¦°à§à¦£à¦šà§à¦›à§‡à¦¦ à¦¬à¦¾ à¦•à§‹à¦²à¦¨) à¦à¦¬à¦‚ à¦¡à§‡à¦¸à¦•à§à¦°à¦¿à¦ªà¦¶à¦¨ à¦¯à§‹à¦— à¦•à¦°à¦¾
        // à¦à¦¤à§‡ à¦ªà§œà¦¾à¦° à¦¸à¦®à§Ÿ à¦à¦•à¦Ÿà¦¿ à¦›à§‹à¦Ÿ à¦ªà¦œ (à¦¬à¦¿à¦°à¦¤à¦¿) à¦¹à¦¬à§‡à¥¤
        const textToSpeak = titleText + '. ' + descriptionText;

        // à¦¯à¦¦à¦¿ à¦•à§‹à¦¨à§‹ à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦¨à¦¾ à¦¥à¦¾à¦•à§‡, à¦¤à¦¾à¦¹à¦²à§‡ à¦•à¦¿à¦›à§ à¦•à¦°à¦¾à¦° à¦¦à¦°à¦•à¦¾à¦° à¦¨à§‡à¦‡
        if (!textToSpeak.trim()) {
            console.warn('No text content found to speak.');
            return;
        }

        // D. à¦¬à¦²à¦¾ à¦¶à§à¦°à§ à¦•à¦°à§‹
        speech = new SpeechSynthesisUtterance(textToSpeak);
        speech.lang = 'bn-BD'; // à¦¬à¦¾à¦‚à¦²à¦¾ à¦­à¦¾à¦·à¦¾ à¦¸à§‡à¦Ÿ à¦•à¦°à§à¦¨

        synth.speak(speech);
        updateUI(true, false);

        // E. à¦¬à¦²à¦¾ à¦¶à§‡à¦· à¦¹à¦²à§‡ UI à¦°à¦¿à¦¸à§‡à¦Ÿ à¦•à¦°à§‹
        speech.onend = () => {
            updateUI(false, false);
        };

        // Error à¦¹à¦²à§‡
        speech.onerror = (event) => {
            console.error('Speech synthesis error:', event);
            updateUI(false, false);
        };
    });

    // 3. Stop Button Click Event (à¦¸à¦®à¦¸à§à¦¤ à¦•à¦¿à¦›à§ à¦¬à¦¨à§à¦§ à¦•à¦°à¦¤à§‡) (à¦†à¦—à§‡à¦° à¦®à¦¤à§‹à¦‡ à¦¥à¦¾à¦•à¦¬à§‡)
    stopBtn.addEventListener('click', () => {
        if (synth.speaking || synth.paused) {
            synth.cancel();
            updateUI(false, false);
        }
    });

    // Initial state set à¦•à¦°à¦¾
    updateUI(false, false);
</script>

{% comment %} emoji picker of blog comment {% endcomment %}
<script>
    const emojiBtn = document.getElementById('emojiBtn');
    const emojiPicker = document.getElementById('emojiPicker');
    const messageInput = document.getElementById('messageInput');

    // Add emoji picker inside container
    emojiPicker.innerHTML = `<emoji-picker style="width: 300px; height: 350px;"></emoji-picker>`;
    const picker = emojiPicker.querySelector('emoji-picker');

    emojiBtn.addEventListener('click', () => {
        emojiPicker.classList.toggle('hidden');
    });

    picker.addEventListener('emoji-click', (event) => {
        messageInput.value += event.detail.unicode;
    });

    const fileBtn = document.getElementById('fileBtn');
    const hiddenFileInput = document.getElementById('hiddenFileInput');

    fileBtn.addEventListener('click', () => {
        hiddenFileInput.click();
    });

    hiddenFileInput.addEventListener('change', (e) => {
        const fileName = e.target.files[0]?.name;
        if (fileName) alert(`ðŸ“Ž Selected file: ${fileName}`);
    });
</script>

{% endblock content %}